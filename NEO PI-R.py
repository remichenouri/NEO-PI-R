# -*- coding: utf-8 -*-
"""Copie de streamlit-depression

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1aTPM4wRrJ7v_bF1skLjv63KbC4rqls62
"""

# -*- coding: utf-8 -*-
"""
Application Streamlit pour le Test NEO PI-R
Test de PersonnalitÃ© des Big Five en ligne gratuit
InspirÃ© du design de depistage-autisme.streamlit.app
"""

import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import json
import base64
import hashlib
import os
import pickle
import requests
from concurrent.futures import ThreadPoolExecutor
from io import BytesIO
from PIL import Image
import streamlit.components.v1 as components
import cryptography
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from datetime import datetime, timedelta
import uuid
import secrets
import time
import scipy.stats as stats
from scipy import stats
import seaborn as sns
import matplotlib.pyplot as plt

# ================= CONFIGURATION INITIALE =================

st.set_page_config(
    page_title="Test NEO PI-R",
    page_icon="ğŸ§ ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ================= CLASSES DE GESTION =================

class SecurityManager:
    """Gestionnaire de sÃ©curitÃ© pour les donnÃ©es utilisateur"""

    def __init__(self):
        self.key = self._generate_key()
        self.cipher_suite = Fernet(self.key)

    def _generate_key(self):
        """GÃ©nÃ¨re une clÃ© de chiffrement"""
        password = b"NEO_PIR_SECURE_2024"
        salt = b"neo_salt_2024"
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=salt,
            iterations=100000,
        )
        key = base64.urlsafe_b64encode(kdf.derive(password))
        return key

    def encrypt_data(self, data):
        """Chiffre les donnÃ©es"""
        if isinstance(data, dict):
            data = json.dumps(data)
        elif not isinstance(data, str):
            data = str(data)
        return self.cipher_suite.encrypt(data.encode())

    def decrypt_data(self, encrypted_data):
        """DÃ©chiffre les donnÃ©es"""
        try:
            decrypted = self.cipher_suite.decrypt(encrypted_data)
            return decrypted.decode()
        except Exception as e:
            st.error(f"Erreur de dÃ©chiffrement : {str(e)}")
            return None

class NEOPIRManager:
    """Gestionnaire principal du test NEO PI-R"""

    def __init__(self):
        self.dimensions = {
            'N': 'Neuroticisme',
            'E': 'Extraversion',
            'O': 'Ouverture',
            'A': 'AgrÃ©abilitÃ©',
            'C': 'ConscienciositÃ©'
        }

        self.facets = {
            'N': ['AnxiÃ©tÃ©', 'HostilitÃ©', 'DÃ©pression', 'TimiditÃ© sociale', 'ImpulsivitÃ©', 'VulnÃ©rabilitÃ©'],
            'E': ['Chaleur', 'GrÃ©garitÃ©', 'AssertivitÃ©', 'ActivitÃ©', 'Recherche de sensations', 'Ã‰motions positives'],
            'O': ['Fantaisie', 'EsthÃ©tique', 'Sentiments', 'Actions', 'IdÃ©es', 'Valeurs'],
            'A': ['Confiance', 'Droiture', 'Altruisme', 'Compliance', 'Modestie', 'SensibilitÃ©'],
            'C': ['CompÃ©tence', 'Ordre', 'Sens du devoir', 'Recherche de rÃ©ussite', 'Autodiscipline', 'DÃ©libÃ©ration']
        }

        self.load_questions()

    def load_questions(self):
        """Charge les questions du NEO PI-R (version courte)"""
        self.questions = [
            # Neuroticisme (N1-N12)
            {"id": "N1", "text": "Je me sens souvent tendu(e) et nerveux(se)", "dimension": "N", "facet": "AnxiÃ©tÃ©", "reverse": False},
            {"id": "N2", "text": "Je me mets facilement en colÃ¨re", "dimension": "N", "facet": "HostilitÃ©", "reverse": False},
            {"id": "N3", "text": "Je me sens souvent triste et mÃ©lancolique", "dimension": "N", "facet": "DÃ©pression", "reverse": False},
            {"id": "N4", "text": "Je me sens mal Ã  l'aise avec les autres", "dimension": "N", "facet": "TimiditÃ© sociale", "reverse": False},
            {"id": "N5", "text": "J'agis souvent sur un coup de tÃªte", "dimension": "N", "facet": "ImpulsivitÃ©", "reverse": False},
            {"id": "N6", "text": "Je me sens souvent submergÃ©(e) par les Ã©vÃ©nements", "dimension": "N", "facet": "VulnÃ©rabilitÃ©", "reverse": False},
            {"id": "N7", "text": "Je suis rarement inquiet(e)", "dimension": "N", "facet": "AnxiÃ©tÃ©", "reverse": True},
            {"id": "N8", "text": "Je reste calme mÃªme dans des situations frustrantes", "dimension": "N", "facet": "HostilitÃ©", "reverse": True},
            {"id": "N9", "text": "Je me sens gÃ©nÃ©ralement de bonne humeur", "dimension": "N", "facet": "DÃ©pression", "reverse": True},
            {"id": "N10", "text": "J'ai confiance en moi dans les situations sociales", "dimension": "N", "facet": "TimiditÃ© sociale", "reverse": True},
            {"id": "N11", "text": "Je rÃ©flÃ©chis avant d'agir", "dimension": "N", "facet": "ImpulsivitÃ©", "reverse": True},
            {"id": "N12", "text": "Je gÃ¨re bien le stress", "dimension": "N", "facet": "VulnÃ©rabilitÃ©", "reverse": True},

            # Extraversion (E1-E12)
            {"id": "E1", "text": "J'aime Ãªtre entourÃ©(e) de beaucoup de monde", "dimension": "E", "facet": "GrÃ©garitÃ©", "reverse": False},
            {"id": "E2", "text": "Je me fais facilement des amis", "dimension": "E", "facet": "Chaleur", "reverse": False},
            {"id": "E3", "text": "Je n'hÃ©site pas Ã  prendre la parole en groupe", "dimension": "E", "facet": "AssertivitÃ©", "reverse": False},
            {"id": "E4", "text": "J'aime que les choses bougent autour de moi", "dimension": "E", "facet": "ActivitÃ©", "reverse": False},
            {"id": "E5", "text": "J'aime les sensations fortes", "dimension": "E", "facet": "Recherche de sensations", "reverse": False},
            {"id": "E6", "text": "Je me sens souvent joyeux(se) et enthousiaste", "dimension": "E", "facet": "Ã‰motions positives", "reverse": False},
            {"id": "E7", "text": "Je prÃ©fÃ¨re Ãªtre seul(e)", "dimension": "E", "facet": "GrÃ©garitÃ©", "reverse": True},
            {"id": "E8", "text": "J'ai du mal Ã  m'ouvrir aux autres", "dimension": "E", "facet": "Chaleur", "reverse": True},
            {"id": "E9", "text": "J'Ã©vite d'Ãªtre le centre d'attention", "dimension": "E", "facet": "AssertivitÃ©", "reverse": True},
            {"id": "E10", "text": "Je prÃ©fÃ¨re un rythme de vie tranquille", "dimension": "E", "facet": "ActivitÃ©", "reverse": True},
            {"id": "E11", "text": "J'Ã©vite les situations risquÃ©es", "dimension": "E", "facet": "Recherche de sensations", "reverse": True},
            {"id": "E12", "text": "Je ne suis pas quelqu'un de trÃ¨s enjouÃ©", "dimension": "E", "facet": "Ã‰motions positives", "reverse": True},

            # Ouverture (O1-O12)
            {"id": "O1", "text": "J'ai une imagination trÃ¨s vive", "dimension": "O", "facet": "Fantaisie", "reverse": False},
            {"id": "O2", "text": "J'apprÃ©cie l'art et la beautÃ©", "dimension": "O", "facet": "EsthÃ©tique", "reverse": False},
            {"id": "O3", "text": "Je ressens intensÃ©ment mes Ã©motions", "dimension": "O", "facet": "Sentiments", "reverse": False},
            {"id": "O4", "text": "J'aime essayer de nouvelles activitÃ©s", "dimension": "O", "facet": "Actions", "reverse": False},
            {"id": "O5", "text": "J'aime rÃ©flÃ©chir Ã  des concepts abstraits", "dimension": "O", "facet": "IdÃ©es", "reverse": False},
            {"id": "O6", "text": "Je remets en question les valeurs traditionnelles", "dimension": "O", "facet": "Valeurs", "reverse": False},
            {"id": "O7", "text": "Je ne suis pas trÃ¨s crÃ©atif(ve)", "dimension": "O", "facet": "Fantaisie", "reverse": True},
            {"id": "O8", "text": "L'art me laisse indiffÃ©rent(e)", "dimension": "O", "facet": "EsthÃ©tique", "reverse": True},
            {"id": "O9", "text": "Je contrÃ´le bien mes Ã©motions", "dimension": "O", "facet": "Sentiments", "reverse": True},
            {"id": "O10", "text": "Je prÃ©fÃ¨re la routine au changement", "dimension": "O", "facet": "Actions", "reverse": True},
            {"id": "O11", "text": "Je ne m'intÃ©resse pas aux discussions philosophiques", "dimension": "O", "facet": "IdÃ©es", "reverse": True},
            {"id": "O12", "text": "Je respecte les traditions Ã©tablies", "dimension": "O", "facet": "Valeurs", "reverse": True},

            # AgrÃ©abilitÃ© (A1-A12)
            {"id": "A1", "text": "Je fais facilement confiance aux autres", "dimension": "A", "facet": "Confiance", "reverse": False},
            {"id": "A2", "text": "Je suis honnÃªte et sincÃ¨re", "dimension": "A", "facet": "Droiture", "reverse": False},
            {"id": "A3", "text": "J'aime aider les autres", "dimension": "A", "facet": "Altruisme", "reverse": False},
            {"id": "A4", "text": "J'Ã©vite les conflits", "dimension": "A", "facet": "Compliance", "reverse": False},
            {"id": "A5", "text": "Je ne me vante pas de mes rÃ©ussites", "dimension": "A", "facet": "Modestie", "reverse": False},
            {"id": "A6", "text": "Je suis sensible aux Ã©motions des autres", "dimension": "A", "facet": "SensibilitÃ©", "reverse": False},
            {"id": "A7", "text": "Je me mÃ©fie des intentions des autres", "dimension": "A", "facet": "Confiance", "reverse": True},
            {"id": "A8", "text": "Il m'arrive de manipuler les autres", "dimension": "A", "facet": "Droiture", "reverse": True},
            {"id": "A9", "text": "Je pense d'abord Ã  moi", "dimension": "A", "facet": "Altruisme", "reverse": True},
            {"id": "A10", "text": "Je n'hÃ©site pas Ã  imposer mon point de vue", "dimension": "A", "facet": "Compliance", "reverse": True},
            {"id": "A11", "text": "Je pense mÃ©riter plus que les autres", "dimension": "A", "facet": "Modestie", "reverse": True},
            {"id": "A12", "text": "Les problÃ¨mes des autres ne me touchent pas", "dimension": "A", "facet": "SensibilitÃ©", "reverse": True},

            # ConscienciositÃ© (C1-C12)
            {"id": "C1", "text": "Je me sens capable de faire face Ã  la plupart des situations", "dimension": "C", "facet": "CompÃ©tence", "reverse": False},
            {"id": "C2", "text": "J'aime que tout soit bien organisÃ©", "dimension": "C", "facet": "Ordre", "reverse": False},
            {"id": "C3", "text": "Je respecte mes engagements", "dimension": "C", "facet": "Sens du devoir", "reverse": False},
            {"id": "C4", "text": "Je me fixe des objectifs Ã©levÃ©s", "dimension": "C", "facet": "Recherche de rÃ©ussite", "reverse": False},
            {"id": "C5", "text": "J'ai une grande force de volontÃ©", "dimension": "C", "facet": "Autodiscipline", "reverse": False},
            {"id": "C6", "text": "Je rÃ©flÃ©chis longuement avant de prendre une dÃ©cision", "dimension": "C", "facet": "DÃ©libÃ©ration", "reverse": False},
            {"id": "C7", "text": "Je doute souvent de mes capacitÃ©s", "dimension": "C", "facet": "CompÃ©tence", "reverse": True},
            {"id": "C8", "text": "Je suis plutÃ´t dÃ©sordonnÃ©(e)", "dimension": "C", "facet": "Ordre", "reverse": True},
            {"id": "C9", "text": "Il m'arrive de ne pas tenir mes promesses", "dimension": "C", "facet": "Sens du devoir", "reverse": True},
            {"id": "C10", "text": "Je me contente facilement de ce que j'ai", "dimension": "C", "facet": "Recherche de rÃ©ussite", "reverse": True},
            {"id": "C11", "text": "J'ai du mal Ã  me contrÃ´ler", "dimension": "C", "facet": "Autodiscipline", "reverse": True},
            {"id": "C12", "text": "Je prends souvent des dÃ©cisions hÃ¢tives", "dimension": "C", "facet": "DÃ©libÃ©ration", "reverse": True},
        ]

    def calculate_scores(self, responses):
        """Calcule les scores pour chaque dimension et facette"""
        scores = {dim: 0 for dim in self.dimensions.keys()}
        facet_scores = {dim: {facet: 0 for facet in self.facets[dim]} for dim in self.dimensions.keys()}

        for question in self.questions:
            question_id = question['id']
            if question_id in responses:
                response = responses[question_id]

                # Inversion si nÃ©cessaire
                if question['reverse']:
                    score = 6 - response  # Ã‰chelle 1-5 inversÃ©e
                else:
                    score = response

                dimension = question['dimension']
                facet = question['facet']

                scores[dimension] += score
                facet_scores[dimension][facet] += score

        # Conversion en percentiles (approximatifs)
        percentiles = {}
        for dim in scores:
            # Normalisation approximative (Ã  ajuster avec vraies normes)
            raw_score = scores[dim]
            max_possible = 12 * 5  # 12 questions par dimension, Ã©chelle 1-5
            percentile = min(100, max(0, (raw_score / max_possible) * 100))
            percentiles[dim] = percentile

        return scores, facet_scores, percentiles

    def get_interpretation(self, percentiles):
        """Fournit une interprÃ©tation des scores"""
        interpretations = {}

        for dim, percentile in percentiles.items():
            if percentile >= 70:
                level = "Ã‰levÃ©"
            elif percentile >= 30:
                level = "Moyen"
            else:
                level = "Faible"

            interpretations[dim] = {
                'level': level,
                'percentile': percentile,
                'description': self.get_dimension_description(dim, level)
            }

        return interpretations

    def get_dimension_description(self, dimension, level):
        """Retourne une description dÃ©taillÃ©e de chaque dimension selon le niveau"""
        descriptions = {
            'N': {
                'Ã‰levÃ©': "Vous avez tendance Ã  Ã©prouver plus souvent des Ã©motions nÃ©gatives comme l'anxiÃ©tÃ©, la tristesse ou la colÃ¨re. Vous pouvez Ãªtre plus sensible au stress.",
                'Moyen': "Vous maintenez un Ã©quilibre Ã©motionnel relatif, avec des pÃ©riodes de stress normal alternant avec des moments de sÃ©rÃ©nitÃ©.",
                'Faible': "Vous Ãªtes gÃ©nÃ©ralement calme, serein et Ã©motionnellement stable. Vous gÃ©rez bien le stress et restez optimiste."
            },
            'E': {
                'Ã‰levÃ©': "Vous Ãªtes sociable, Ã©nergique et aimez Ãªtre entourÃ©. Vous cherchez la stimulation et Ãªtes souvent de bonne humeur.",
                'Moyen': "Vous apprÃ©ciez la compagnie des autres tout en valorisant aussi les moments de solitude. Votre niveau d'Ã©nergie est Ã©quilibrÃ©.",
                'Faible': "Vous prÃ©fÃ©rez les interactions en petit groupe ou la solitude. Vous Ãªtes plus rÃ©servÃ© et rÃ©flÃ©chi dans vos actions."
            },
            'O': {
                'Ã‰levÃ©': "Vous Ãªtes crÃ©atif, curieux et ouvert aux nouvelles expÃ©riences. Vous apprÃ©ciez l'art, les idÃ©es abstraites et le changement.",
                'Moyen': "Vous montrez un intÃ©rÃªt modÃ©rÃ© pour les nouvelles expÃ©riences, combinant ouverture et pragmatisme.",
                'Faible': "Vous prÃ©fÃ©rez la familiaritÃ© et les mÃ©thodes Ã©prouvÃ©es. Vous Ãªtes pragmatique et moins attirÃ© par l'abstraction."
            },
            'A': {
                'Ã‰levÃ©': "Vous Ãªtes coopÃ©ratif, confiant et bienveillant envers les autres. Vous Ã©vitez les conflits et cherchez l'harmonie.",
                'Moyen': "Vous Ã©quilibrez coopÃ©ration et compÃ©tition, confiance et prudence selon les situations.",
                'Faible': "Vous Ãªtes plus compÃ©titif et sceptique. Vous dÃ©fendez vos intÃ©rÃªts et pouvez Ãªtre plus direct dans vos interactions."
            },
            'C': {
                'Ã‰levÃ©': "Vous Ãªtes organisÃ©, disciplinÃ© et persÃ©vÃ©rant. Vous planifiez soigneusement et atteignez vos objectifs mÃ©thodiquement.",
                'Moyen': "Vous trouvez un Ã©quilibre entre organisation et flexibilitÃ©, planification et spontanÃ©itÃ©.",
                'Faible': "Vous Ãªtes plus flexible et spontanÃ©. Vous prÃ©fÃ©rez vous adapter aux situations plutÃ´t que de tout planifier."
            }
        }

        return descriptions.get(dimension, {}).get(level, "Description non disponible")

# ================= FONCTIONS UTILITAIRES =================

def hash_user_data(data: str) -> str:
    """Hache les donnÃ©es utilisateur pour la sÃ©curitÃ©"""
    return hashlib.sha256(data.encode()).hexdigest()

def initialize_session_state():
    """Initialise l'Ã©tat de session"""
    if 'initialized' not in st.session_state:
        st.session_state.initialized = True
        st.session_state.user_session_id = str(uuid.uuid4())
        st.session_state.session_start = datetime.now()
        st.session_state.tool_choice = "ğŸ  Accueil"
        st.session_state.test_started = False
        st.session_state.test_completed = False
        st.session_state.responses = {}
        st.session_state.current_question = 0
        st.session_state.scores = {}
        st.session_state.interpretations = {}

def set_custom_theme():
    """Applique le thÃ¨me personnalisÃ© inspirÃ© du site de rÃ©fÃ©rence"""
    css_theme = """
    <style>
    /* Variables globales */
    :root {
        --primary: #2c3e50 !important;
        --secondary: #3498db !important;
        --accent: #e74c3c !important;
        --background: #f8f9fa !important;
        --sidebar-bg: #ffffff !important;
        --sidebar-border: #e9ecef !important;
        --text-primary: #2c3e50 !important;
        --text-secondary: #6c757d !important;
        --sidebar-width-collapsed: 60px !important;
        --sidebar-width-expanded: 240px !important;
        --sidebar-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        --shadow-light: 0 2px 8px rgba(0,0,0,0.08) !important;
        --shadow-medium: 0 4px 16px rgba(0,0,0,0.12) !important;
    }

    /* Structure principale */
    [data-testid="stAppViewContainer"] {
        background-color: var(--background) !important;
    }

    /* Sidebar compacte */
    [data-testid="stSidebar"] {
        width: var(--sidebar-width-collapsed) !important;
        min-width: var(--sidebar-width-collapsed) !important;
        max-width: var(--sidebar-width-collapsed) !important;
        height: 100vh !important;
        position: fixed !important;
        left: 0 !important;
        top: 0 !important;
        z-index: 999999 !important;
        background: var(--sidebar-bg) !important;
        border-right: 1px solid var(--sidebar-border) !important;
        box-shadow: var(--shadow-light) !important;
        overflow: hidden !important;
        padding: 0 !important;
        transition: var(--sidebar-transition) !important;
    }

    [data-testid="stSidebar"]:hover {
        width: var(--sidebar-width-expanded) !important;
        min-width: var(--sidebar-width-expanded) !important;
        max-width: var(--sidebar-width-expanded) !important;
        box-shadow: var(--shadow-medium) !important;
        overflow-y: auto !important;
    }

    [data-testid="stSidebar"] > div {
        width: var(--sidebar-width-expanded) !important;
        padding: 12px 8px !important;
        height: 100vh !important;
        overflow: hidden !important;
    }

    [data-testid="stSidebar"]:hover > div {
        overflow-y: auto !important;
        padding: 16px 12px !important;
    }

    /* En-tÃªte de la sidebar */
    [data-testid="stSidebar"] h2 {
        font-size: 0 !important;
        margin: 0 0 20px 0 !important;
        padding: 12px 0 !important;
        border-bottom: 1px solid var(--sidebar-border) !important;
        text-align: center !important;
        transition: all 0.3s ease !important;
        position: relative !important;
        height: 60px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    [data-testid="stSidebar"] h2::before {
        content: "ğŸ§ " !important;
        font-size: 28px !important;
        display: block !important;
        margin: 0 !important;
    }

    [data-testid="stSidebar"]:hover h2 {
        font-size: 1.4rem !important;
        color: var(--primary) !important;
        font-weight: 600 !important;
    }

    [data-testid="stSidebar"]:hover h2::before {
        font-size: 20px !important;
        margin-right: 8px !important;
    }

    /* Options de navigation */
    [data-testid="stSidebar"] .stRadio {
        padding: 0 !important;
        margin: 0 !important;
    }

    [data-testid="stSidebar"] .stRadio > div {
        display: flex !important;
        flex-direction: column !important;
        gap: 4px !important;
        padding: 0 !important;
    }

    [data-testid="stSidebar"] .stRadio label {
        display: flex !important;
        align-items: center !important;
        padding: 10px 6px !important;
        margin: 0 !important;
        border-radius: 8px !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
        position: relative !important;
        height: 44px !important;
        overflow: hidden !important;
        background: transparent !important;
    }

    [data-testid="stSidebar"] .stRadio label > div:first-child {
        display: none !important;
    }

    [data-testid="stSidebar"] .stRadio label span {
        font-size: 0 !important;
        transition: all 0.3s ease !important;
        width: 100% !important;
        text-align: center !important;
        position: relative !important;
    }

    [data-testid="stSidebar"] .stRadio label span::before {
        font-size: 22px !important;
        display: block !important;
        width: 100% !important;
        text-align: center !important;
    }

    /* IcÃ´nes pour chaque option */
    [data-testid="stSidebar"] .stRadio label:nth-child(1) span::before { content: "ğŸ " !important; }
    [data-testid="stSidebar"] .stRadio label:nth-child(2) span::before { content: "ğŸ“" !important; }
    [data-testid="stSidebar"] .stRadio label:nth-child(3) span::before { content: "ğŸ“Š" !important; }
    [data-testid="stSidebar"] .stRadio label:nth-child(4) span::before { content: "â„¹ï¸" !important; }

    /* Mode Ã©tendu */
    [data-testid="stSidebar"]:hover .stRadio label span {
        font-size: 14px !important;
        font-weight: 500 !important;
        text-align: left !important;
        padding-left: 12px !important;
    }

    [data-testid="stSidebar"]:hover .stRadio label span::before {
        font-size: 18px !important;
        position: absolute !important;
        left: -8px !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        width: auto !important;
    }

    /* Effets de survol */
    [data-testid="stSidebar"] .stRadio label:hover {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef) !important;
        transform: translateX(3px) !important;
        box-shadow: var(--shadow-light) !important;
    }

    [data-testid="stSidebar"] .stRadio label[data-checked="true"] {
        background: linear-gradient(135deg, var(--secondary), #2980b9) !important;
        color: white !important;
        box-shadow: var(--shadow-medium) !important;
    }

    /* Contenu principal */
    .main .block-container {
        margin-left: calc(var(--sidebar-width-collapsed) + 16px) !important;
        padding: 1.5rem !important;
        max-width: calc(100vw - var(--sidebar-width-collapsed) - 32px) !important;
        transition: var(--sidebar-transition) !important;
    }

    /* Boutons stylisÃ©s */
    .stButton > button {
        background: linear-gradient(135deg, var(--secondary), #2980b9) !important;
        color: white !important;
        border-radius: 8px !important;
        border: none !important;
        padding: 10px 20px !important;
        font-weight: 500 !important;
        transition: all 0.3s ease !important;
        box-shadow: var(--shadow-light) !important;
    }

    .stButton > button:hover {
        transform: translateY(-2px) !important;
        box-shadow: var(--shadow-medium) !important;
        background: linear-gradient(135deg, #2980b9, var(--secondary)) !important;
    }

    /* Cards d'information */
    .info-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin: 15px 0;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border-left: 4px solid #3498db;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    /* Questions du test */
    .question-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin: 10px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid #2ecc71;
    }

    /* Responsive */
    @media (max-width: 768px) {
        [data-testid="stSidebar"] {
            transform: translateX(-100%) !important;
        }

        [data-testid="stSidebar"]:hover {
            transform: translateX(0) !important;
            width: 280px !important;
            min-width: 280px !important;
            max-width: 280px !important;
        }

        .main .block-container {
            margin-left: 0 !important;
            max-width: 100vw !important;
            padding: 1rem !important;
        }
    }
    </style>
    """

    st.markdown(css_theme, unsafe_allow_html=True)

@st.cache_data
def create_personality_chart(scores, interpretations):
    """CrÃ©e un graphique radar de la personnalitÃ©"""
    dimensions = list(scores.keys())
    values = [interpretations[dim]['percentile'] for dim in dimensions]

    # Ajout du premier point Ã  la fin pour fermer le radar
    dimensions_radar = dimensions + [dimensions[0]]
    values_radar = values + [values[0]]

    fig = go.Figure()

    fig.add_trace(go.Scatterpolar(
        r=values_radar,
        theta=dimensions_radar,
        fill='toself',
        name='Votre profil',
        fillcolor='rgba(52, 152, 219, 0.3)',
        line=dict(color='#3498db', width=3)
    ))

    fig.update_layout(
        polar=dict(
            radialaxis=dict(
                visible=True,
                range=[0, 100],
                tickvals=[20, 40, 60, 80, 100],
                ticktext=['20%', '40%', '60%', '80%', '100%']
            )
        ),
        showlegend=False,
        title="Votre Profil de PersonnalitÃ© NEO PI-R",
        title_x=0.5,
        height=500
    )

    return fig

@st.cache_data
def create_facet_chart(facet_scores, dimension):
    """CrÃ©e un graphique des facettes pour une dimension"""
    facets = list(facet_scores[dimension].keys())
    values = list(facet_scores[dimension].values())

    fig = px.bar(
        x=values,
        y=facets,
        orientation='h',
        title=f"Facettes de {dimension}",
        labels={'x': 'Score', 'y': 'Facettes'},
        color=values,
        color_continuous_scale='Blues'
    )

    fig.update_layout(
        height=400,
        showlegend=False,
        coloraxis_showscale=False
    )

    return fig

# ================= PAGES DE L'APPLICATION =================

def show_navigation_menu():
    """Menu de navigation principal"""
    st.markdown("## ğŸ§  NEO PI-R - Navigation")
    st.markdown("Choisissez une section :")

    options = [
        "ğŸ  Accueil",
        "ğŸ“ Passer le Test",
        "ğŸ“Š RÃ©sultats",
        "â„¹ï¸ Ã€ propos"
    ]

    if 'tool_choice' not in st.session_state or st.session_state.tool_choice not in options:
        st.session_state.tool_choice = "ğŸ  Accueil"

    current_index = options.index(st.session_state.tool_choice)

    tool_choice = st.radio(
        "",
        options,
        label_visibility="collapsed",
        index=current_index,
        key="main_navigation"
    )

    if tool_choice != st.session_state.tool_choice:
        st.session_state.tool_choice = tool_choice

    return tool_choice

def show_home_page():
    """Page d'accueil du test NEO PI-R"""
    # En-tÃªte principal
    st.markdown("""
    <div style="background: linear-gradient(90deg, #3498db, #2ecc71);
                padding: 40px 25px; border-radius: 20px; margin-bottom: 35px; text-align: center;">
        <h1 style="color: white; font-size: 2.8rem; margin-bottom: 15px;
                   text-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: 600;">
            ğŸ§  Test de PersonnalitÃ© NEO PI-R
        </h1>
        <p style="color: rgba(255,255,255,0.95); font-size: 1.3rem;
                  max-width: 800px; margin: 0 auto; line-height: 1.6;">
            DÃ©couvrez votre profil de personnalitÃ© avec l'un des tests les plus fiables de la psychologie
        </p>
    </div>
    """, unsafe_allow_html=True)

    # Section "Qu'est-ce que le NEO PI-R ?"
    st.markdown("""
    <div class="info-card">
        <h2 style="color: #3498db; margin-bottom: 25px; font-size: 2.2rem; text-align: center;">
            ğŸ”¬ Qu'est-ce que le NEO PI-R ?
        </h2>
        <p style="font-size: 1.2rem; line-height: 1.8; text-align: justify;
                  max-width: 900px; margin: 0 auto; color: #2c3e50;">
            Le <strong>NEO PI-R (NEO Personality Inventory-Revised)</strong> est l'un des outils de mesure
            de la personnalitÃ© les plus utilisÃ©s et respectÃ©s en psychologie. DÃ©veloppÃ© par Paul Costa et
            Robert McCrae, ce test Ã©value votre personnalitÃ© selon le modÃ¨le des <strong>Big Five</strong>,
            considÃ©rÃ© comme la rÃ©fÃ©rence internationale en matiÃ¨re de traits de personnalitÃ©.
        </p>
    </div>
    """, unsafe_allow_html=True)

    # Les 5 dimensions principales
    st.markdown("""
    <h2 style="color: #3498db; margin: 45px 0 25px 0; text-align: center; font-size: 2.2rem;">
        ğŸŒŸ Les Cinq Grandes Dimensions de la PersonnalitÃ©
    </h2>
    """, unsafe_allow_html=True)

    # Grille des dimensions
    col1, col2 = st.columns(2)

    with col1:
        st.markdown("""
        <div style="background: linear-gradient(135deg, #e74c3c, #c0392b);
                   color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; height: 200px;">
            <h3 style="margin-top: 0; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ˜°</span>
                Neuroticisme (N)
            </h3>
            <p style="line-height: 1.6; font-size: 0.95rem;">
                Tendance Ã  Ã©prouver des Ã©motions nÃ©gatives comme l'anxiÃ©tÃ©, la dÃ©pression,
                l'hostilitÃ©. Mesure votre stabilitÃ© Ã©motionnelle et votre gestion du stress.
            </p>
        </div>
        """, unsafe_allow_html=True)

        st.markdown("""
        <div style="background: linear-gradient(135deg, #2ecc71, #27ae60);
                   color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; height: 200px;">
            <h3 style="margin-top: 0; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ¨</span>
                Ouverture (O)
            </h3>
            <p style="line-height: 1.6; font-size: 0.95rem;">
                Ouverture aux expÃ©riences nouvelles, Ã  l'imagination, Ã  l'art, aux Ã©motions,
                aux idÃ©es et aux valeurs non conventionnelles.
            </p>
        </div>
        """, unsafe_allow_html=True)

        st.markdown("""
        <div style="background: linear-gradient(135deg, #9b59b6, #8e44ad);
                   color: white; padding: 25px; border-radius: 15px; height: 200px;">
            <h3 style="margin-top: 0; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ“‹</span>
                ConscienciositÃ© (C)
            </h3>
            <p style="line-height: 1.6; font-size: 0.95rem;">
                Organisation, persÃ©vÃ©rance, contrÃ´le des impulses et orientation vers les objectifs.
                Mesure votre autodiscipline et votre fiabilitÃ©.
            </p>
        </div>
        """, unsafe_allow_html=True)

    with col2:
        st.markdown("""
        <div style="background: linear-gradient(135deg, #f39c12, #e67e22);
                   color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; height: 200px;">
            <h3 style="margin-top: 0; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ‰</span>
                Extraversion (E)
            </h3>
            <p style="line-height: 1.6; font-size: 0.95rem;">
                Niveau d'activitÃ© sociale, d'assertivitÃ©, d'Ã©motions positives et de recherche
                de stimulation. Mesure votre sociabilitÃ© et votre Ã©nergie.
            </p>
        </div>
        """, unsafe_allow_html=True)

        st.markdown("""
        <div style="background: linear-gradient(135deg, #3498db, #2980b9);
                   color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; height: 200px;">
            <h3 style="margin-top: 0; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ¤</span>
                AgrÃ©abilitÃ© (A)
            </h3>
            <p style="line-height: 1.6; font-size: 0.95rem;">
                CoopÃ©ration, confiance, altruisme et tendance Ã  Ã©viter les conflits.
                Mesure votre bienveillance envers les autres.
            </p>
        </div>
        """, unsafe_allow_html=True)

    # Section utilitÃ© du test
    st.markdown("""
    <h2 style="color: #3498db; margin: 45px 0 25px 0; text-align: center; font-size: 2.2rem;">
        ğŸ¯ Pourquoi passer ce test ?
    </h2>
    """, unsafe_allow_html=True)

    col1, col2, col3 = st.columns(3)

    benefits = [
        {
            "title": "ğŸ” Connaissance de soi",
            "items": ["Comprendre vos traits dominants", "Identifier vos forces et dÃ©fis", "Mieux vous connaÃ®tre", "DÃ©veloppement personnel"],
            "gradient": "linear-gradient(135deg, #3498db, #2980b9)"
        },
        {
            "title": "ğŸ’¼ Orientation professionnelle",
            "items": ["MÃ©tiers adaptÃ©s Ã  votre profil", "Style de management", "Environnement de travail", "Ã‰volution de carriÃ¨re"],
            "gradient": "linear-gradient(135deg, #2ecc71, #27ae60)"
        },
        {
            "title": "ğŸ‘¥ Relations interpersonnelles",
            "items": ["AmÃ©liorer vos relations", "Comprendre les autres", "Communication efficace", "RÃ©solution de conflits"],
            "gradient": "linear-gradient(135deg, #9b59b6, #8e44ad)"
        }
    ]

    for i, (benefit, col) in enumerate(zip(benefits, [col1, col2, col3])):
        with col:
            items_html = "".join([f"<li>{item}</li>" for item in benefit['items']])
            st.markdown(f"""
            <div style="background: {benefit['gradient']}; color: white;
                       padding: 25px; border-radius: 15px; height: 280px;
                       box-shadow: 0 6px 20px rgba(0,0,0,0.15);">
                <h3 style="border-bottom: 2px solid rgba(255,255,255,0.3);
                          padding-bottom: 12px; margin-bottom: 20px; font-size: 1.3rem;">
                    {benefit['title']}
                </h3>
                <ul style="padding-left: 20px; margin: 0; line-height: 1.8;">
                    {items_html}
                </ul>
            </div>
            """, unsafe_allow_html=True)

    # Section fonctionnement
    st.markdown("""
    <h2 style="color: #3498db; margin: 45px 0 25px 0; text-align: center; font-size: 2.2rem;">
        âš™ï¸ Comment fonctionne le test ?
    </h2>
    """, unsafe_allow_html=True)

    st.markdown("""
    <div class="info-card">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                <h4 style="color: #3498db; margin-top: 0;">ğŸ“ 60 Questions</h4>
                <p style="color: #2c3e50; margin: 0;">Questions soigneusement sÃ©lectionnÃ©es pour Ã©valuer chaque dimension</p>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                <h4 style="color: #3498db; margin-top: 0;">â±ï¸ 10-15 minutes</h4>
                <p style="color: #2c3e50; margin: 0;">DurÃ©e moyenne pour complÃ©ter le test en toute sÃ©rÃ©nitÃ©</p>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                <h4 style="color: #3498db; margin-top: 0;">ğŸ“Š Analyse dÃ©taillÃ©e</h4>
                <p style="color: #2c3e50; margin: 0;">RÃ©sultats complets avec interprÃ©tations personnalisÃ©es</p>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                <h4 style="color: #3498db; margin-top: 0;">ğŸ”’ ConfidentialitÃ©</h4>
                <p style="color: #2c3e50; margin: 0;">Vos donnÃ©es restent privÃ©es et sÃ©curisÃ©es</p>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Instructions
    st.markdown("""
    <h2 style="color: #3498db; margin: 45px 0 25px 0; text-align: center; font-size: 2.2rem;">
        ğŸ“‹ Instructions pour le test
    </h2>
    """, unsafe_allow_html=True)

    st.markdown("""
    <div class="info-card">
        <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h4 style="color: #2c3e50; margin-top: 0;">ğŸ¯ Conseils pour obtenir des rÃ©sultats prÃ©cis</h4>
            <ul style="color: #34495e; padding-left: 25px; line-height: 1.8;">
                <li><strong>Soyez honnÃªte</strong> : RÃ©pondez selon ce que vous Ãªtes vraiment, pas selon ce que vous aimeriez Ãªtre</li>
                <li><strong>PremiÃ¨re impression</strong> : Choisissez la rÃ©ponse qui vous vient spontanÃ©ment Ã  l'esprit</li>
                <li><strong>Pas de "bonne" rÃ©ponse</strong> : Il n'y a pas de profil idÃ©al, chaque personnalitÃ© a ses forces</li>
                <li><strong>Contexte gÃ©nÃ©ral</strong> : Pensez Ã  votre comportement habituel, pas Ã  des situations exceptionnelles</li>
                <li><strong>Prenez votre temps</strong> : Mais ne rÃ©flÃ©chissez pas trop longtemps Ã  chaque question</li>
            </ul>
        </div>

        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h4 style="color: #856404; margin-top: 0;">âš ï¸ Important Ã  savoir</h4>
            <ul style="color: #856404; padding-left: 25px; line-height: 1.8;">
                <li>Ce test est Ã  des fins Ã©ducatives et de dÃ©veloppement personnel</li>
                <li>Il ne remplace pas une Ã©valuation psychologique professionnelle</li>
                <li>Vos rÃ©sultats peuvent Ã©voluer avec le temps et les expÃ©riences</li>
                <li>Toutes les dimensions de personnalitÃ© ont leur valeur</li>
            </ul>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Bouton pour commencer
    st.markdown("<br>", unsafe_allow_html=True)

    col1, col2, col3 = st.columns([1, 2, 1])
    with col2:
        if st.button("ğŸš€ Commencer le Test NEO PI-R", type="primary", use_container_width=True):
            st.session_state.tool_choice = "ğŸ“ Passer le Test"
            st.session_state.test_started = True
            st.rerun()

    # Footer
    st.markdown("""
    <div style="margin: 40px 0 30px 0; padding: 20px; border-radius: 12px;
               border-left: 4px solid #3498db; background: linear-gradient(135deg, #f8f9fa, #e9ecef);
               box-shadow: 0 4px 12px rgba(52, 152, 219, 0.1);">
        <p style="font-size: 1rem; color: #2c3e50; text-align: center; margin: 0; line-height: 1.6;">
            <strong style="color: #3498db;">ğŸ’¡ Bon Ã  savoir :</strong>
            Le modÃ¨le des Big Five est utilisÃ© dans de nombreux domaines : recrutement, coaching,
            recherche en psychologie, et dÃ©veloppement personnel.
        </p>
    </div>
    """, unsafe_allow_html=True)

def show_test_page():
    """Page du test NEO PI-R"""
    neo_manager = NEOPIRManager()

    if not st.session_state.test_started:
        st.session_state.test_started = True
        st.session_state.current_question = 0
        st.session_state.responses = {}

    total_questions = len(neo_manager.questions)
    progress = st.session_state.current_question / total_questions

    # En-tÃªte avec progression
    st.markdown(f"""
    <div style="background: linear-gradient(90deg, #3498db, #2ecc71);
                padding: 30px 25px; border-radius: 20px; margin-bottom: 25px; text-align: center;">
        <h1 style="color: white; font-size: 2.5rem; margin-bottom: 10px;
                   text-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: 600;">
            ğŸ“ Test NEO PI-R en cours
        </h1>
        <p style="color: rgba(255,255,255,0.95); font-size: 1.1rem; margin: 0;">
            Question {st.session_state.current_question + 1} sur {total_questions}
        </p>
    </div>
    """, unsafe_allow_html=True)

    # Barre de progression
    st.progress(progress)

    if st.session_state.current_question < total_questions:
        # Question actuelle
        current_q = neo_manager.questions[st.session_state.current_question]

        # Affichage de la question
        st.markdown(f"""
        <div class="question-card">
            <h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.4rem;">
                Question {st.session_state.current_question + 1} / {total_questions}
            </h3>
            <p style="font-size: 1.2rem; line-height: 1.6; color: #34495e; margin-bottom: 25px;">
                <strong>{current_q['text']}</strong>
            </p>
        </div>
        """, unsafe_allow_html=True)

        # Options de rÃ©ponse
        st.markdown("### Votre rÃ©ponse :")

        response_options = [
            "Pas du tout d'accord",
            "PlutÃ´t pas d'accord",
            "Ni d'accord ni pas d'accord",
            "PlutÃ´t d'accord",
            "Tout Ã  fait d'accord"
        ]

        # RÃ©cupÃ©ration de la rÃ©ponse prÃ©cÃ©dente si elle existe
        previous_response = st.session_state.responses.get(current_q['id'], None)
        default_index = previous_response - 1 if previous_response else 0

        response = st.radio(
            "Choisissez votre niveau d'accord :",
            response_options,
            index=default_index,
            key=f"question_{current_q['id']}",
            label_visibility="collapsed"
        )

        # Conversion en score numÃ©rique
        response_score = response_options.index(response) + 1
        st.session_state.responses[current_q['id']] = response_score

        # Boutons de navigation
        col1, col2, col3 = st.columns([2, 1, 2])

        with col1:
            if st.session_state.current_question > 0:
                if st.button("â¬…ï¸ Question prÃ©cÃ©dente", use_container_width=True):
                    st.session_state.current_question -= 1
                    st.rerun()

        with col3:
            if st.session_state.current_question < total_questions - 1:
                if st.button("Question suivante â¡ï¸", type="primary", use_container_width=True):
                    st.session_state.current_question += 1
                    st.rerun()
            else:
                if st.button("ğŸ¯ Terminer le test", type="primary", use_container_width=True):
                    # Calcul des scores
                    scores, facet_scores, percentiles = neo_manager.calculate_scores(st.session_state.responses)
                    interpretations = neo_manager.get_interpretation(percentiles)

                    # Sauvegarde des rÃ©sultats
                    st.session_state.scores = scores
                    st.session_state.facet_scores = facet_scores
                    st.session_state.percentiles = percentiles
                    st.session_state.interpretations = interpretations
                    st.session_state.test_completed = True

                    # Redirection vers les rÃ©sultats
                    st.session_state.tool_choice = "ğŸ“Š RÃ©sultats"
                    st.rerun()

        # Informations sur la dimension actuelle
        dimension = current_q['dimension']
        dimension_name = neo_manager.dimensions[dimension]
        facet = current_q['facet']

        st.markdown(f"""
        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px;">
            <p style="color: #6c757d; margin: 0; text-align: center;">
                <strong>Dimension Ã©valuÃ©e :</strong> {dimension_name} ({dimension}) - Facette : {facet}
            </p>
        </div>
        """, unsafe_allow_html=True)

    else:
        # Test terminÃ©
        st.success("ğŸ‰ Test terminÃ© ! Redirection vers vos rÃ©sultats...")
        time.sleep(2)
        st.session_state.tool_choice = "ğŸ“Š RÃ©sultats"
        st.rerun()

def show_results_page():
    """Page des rÃ©sultats du test NEO PI-R"""
    if not st.session_state.test_completed:
        st.warning("âš ï¸ Vous devez d'abord passer le test pour voir vos rÃ©sultats.")
        if st.button("ğŸ“ Passer le test"):
            st.session_state.tool_choice = "ğŸ“ Passer le Test"
            st.rerun()
        return

    neo_manager = NEOPIRManager()

    # En-tÃªte des rÃ©sultats
    st.markdown("""
    <div style="background: linear-gradient(90deg, #27ae60, #2ecc71);
                padding: 40px 25px; border-radius: 20px; margin-bottom: 35px; text-align: center;">
        <h1 style="color: white; font-size: 2.8rem; margin-bottom: 15px;
                   text-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: 600;">
            ğŸ“Š Vos RÃ©sultats NEO PI-R
        </h1>
        <p style="color: rgba(255,255,255,0.95); font-size: 1.3rem;
                  max-width: 800px; margin: 0 auto; line-height: 1.6;">
            DÃ©couvrez votre profil de personnalitÃ© unique
        </p>
    </div>
    """, unsafe_allow_html=True)

    # Tabs pour organiser les rÃ©sultats
    tab1, tab2, tab3, tab4 = st.tabs([
        "ğŸ¯ Vue d'ensemble",
        "ğŸ“ˆ Profil dÃ©taillÃ©",
        "ğŸ” Analyse par dimension",
        "ğŸ’¡ Recommandations"
    ])

    with tab1:
        # Vue d'ensemble du profil
        st.markdown("## ğŸ¯ Votre Profil de PersonnalitÃ©")

        # Graphique radar
        fig_radar = create_personality_chart(st.session_state.scores, st.session_state.interpretations)
        st.plotly_chart(fig_radar, use_container_width=True)

        # RÃ©sumÃ© des scores
        st.markdown("### ğŸ“Š Vos Scores par Dimension")

        # CrÃ©ation du tableau de scores
        results_data = []
        for dim in ['N', 'E', 'O', 'A', 'C']:
            dim_name = neo_manager.dimensions[dim]
            interp = st.session_state.interpretations[dim]
            results_data.append({
                'Dimension': f"{dim_name} ({dim})",
                'Percentile': f"{interp['percentile']:.0f}%",
                'Niveau': interp['level'],
                'Score brut': st.session_state.scores[dim]
            })

        df_results = pd.DataFrame(results_data)
        st.dataframe(df_results, use_container_width=True, hide_index=True)

        # InterprÃ©tation gÃ©nÃ©rale
        st.markdown("### ğŸ” InterprÃ©tation GÃ©nÃ©rale")

        # Identification du trait dominant
        max_percentile = max(st.session_state.percentiles.values())
        dominant_dim = [dim for dim, perc in st.session_state.percentiles.items() if perc == max_percentile][0]
        dominant_name = neo_manager.dimensions[dominant_dim]

        # Identification du trait le plus faible
        min_percentile = min(st.session_state.percentiles.values())
        lowest_dim = [dim for dim, perc in st.session_state.percentiles.items() if perc == min_percentile][0]
        lowest_name = neo_manager.dimensions[lowest_dim]

        st.markdown(f"""
        <div class="info-card">
            <h4 style="color: #2c3e50; margin-top: 0;">ğŸŒŸ Votre profil en un coup d'Å“il</h4>
            <p style="color: #34495e; line-height: 1.6;">
                Votre trait de personnalitÃ© le plus marquÃ© est <strong>{dominant_name}</strong>
                ({max_percentile:.0f}e percentile), ce qui suggÃ¨re que {st.session_state.interpretations[dominant_dim]['description'].lower()}
            </p>
            <p style="color: #34495e; line-height: 1.6;">
                Votre score le plus modÃ©rÃ© concerne <strong>{lowest_name}</strong>
                ({min_percentile:.0f}e percentile), indiquant que {st.session_state.interpretations[lowest_dim]['description'].lower()}
            </p>
        </div>
        """, unsafe_allow_html=True)

    with tab2:
        # Profil dÃ©taillÃ© avec graphiques
        st.markdown("## ğŸ“ˆ Analyse DÃ©taillÃ©e de Votre Profil")

        # Graphique en barres des percentiles
        dimensions = list(neo_manager.dimensions.values())
        percentiles = [st.session_state.percentiles[dim] for dim in ['N', 'E', 'O', 'A', 'C']]

        fig_bar = px.bar(
            x=dimensions,
            y=percentiles,
            title="Vos Percentiles par Dimension",
            labels={'x': 'Dimensions', 'y': 'Percentile'},
            color=percentiles,
            color_continuous_scale='RdYlBu_r'
        )

        fig_bar.add_hline(y=50, line_dash="dash", line_color="gray",
                         annotation_text="Moyenne (50e percentile)")
        fig_bar.add_hline(y=70, line_dash="dash", line_color="red",
                         annotation_text="Niveau Ã©levÃ© (70e percentile)")
        fig_bar.add_hline(y=30, line_dash="dash", line_color="blue",
                         annotation_text="Niveau faible (30e percentile)")

        fig_bar.update_layout(showlegend=False, height=500)
        st.plotly_chart(fig_bar, use_container_width=True)

        # Comparaison avec la population gÃ©nÃ©rale
        st.markdown("### ğŸ‘¥ Comparaison avec la Population GÃ©nÃ©rale")

        col1, col2 = st.columns(2)

        with col1:
            # Graphique de distribution normale
            fig_dist = go.Figure()

            x = np.linspace(0, 100, 100)
            y = stats.norm.pdf(x, 50, 15)  # Distribution normale centrÃ©e sur 50

            fig_dist.add_trace(go.Scatter(
                x=x, y=y,
                mode='lines',
                name='Population gÃ©nÃ©rale',
                fill='tozeroy',
                fillcolor='rgba(52, 152, 219, 0.3)',
                line=dict(color='#3498db')
            ))

            # Ajout des positions du participant
            for dim in ['N', 'E', 'O', 'A', 'C']:
                percentile = st.session_state.percentiles[dim]
                y_pos = stats.norm.pdf(percentile, 50, 15)
                fig_dist.add_trace(go.Scatter(
                    x=[percentile],
                    y=[y_pos],
                    mode='markers',
                    name=neo_manager.dimensions[dim],
                    marker=dict(size=12)
                ))

            fig_dist.update_layout(
                title="Votre Position dans la Distribution",
                xaxis_title="Percentile",
                yaxis_title="DensitÃ©",
                height=400
            )

            st.plotly_chart(fig_dist, use_container_width=True)

        with col2:
            st.markdown("#### ğŸ“Š RÃ©partition de vos scores")

            # Comptage par niveau
            levels_count = {'Ã‰levÃ©': 0, 'Moyen': 0, 'Faible': 0}
            for interp in st.session_state.interpretations.values():
                levels_count[interp['level']] += 1

            fig_pie = px.pie(
                values=list(levels_count.values()),
                names=list(levels_count.keys()),
                title="RÃ©partition de vos niveaux",
                color_discrete_map={'Ã‰levÃ©': '#e74c3c', 'Moyen': '#f39c12', 'Faible': '#3498db'}
            )

            st.plotly_chart(fig_pie, use_container_width=True)

            # MÃ©triques
            st.metric("Traits Ã©levÃ©s", levels_count['Ã‰levÃ©'],
                     f"{levels_count['Ã‰levÃ©']}/5 dimensions")
            st.metric("Traits moyens", levels_count['Moyen'],
                     f"{levels_count['Moyen']}/5 dimensions")
            st.metric("Traits faibles", levels_count['Faible'],
                     f"{levels_count['Faible']}/5 dimensions")

    with tab3:
        # Analyse dÃ©taillÃ©e par dimension
        st.markdown("## ğŸ” Analyse Approfondie par Dimension")

        # SÃ©lecteur de dimension
        selected_dim = st.selectbox(
            "Choisissez une dimension Ã  analyser en dÃ©tail :",
            options=['N', 'E', 'O', 'A', 'C'],
            format_func=lambda x: f"{neo_manager.dimensions[x]} ({x})",
            key="dimension_selector"
        )

        interp = st.session_state.interpretations[selected_dim]
        dim_name = neo_manager.dimensions[selected_dim]

        # En-tÃªte de la dimension
        level_color = {'Ã‰levÃ©': '#e74c3c', 'Moyen': '#f39c12', 'Faible': '#3498db'}[interp['level']]

        st.markdown(f"""
        <div style="background: linear-gradient(135deg, {level_color}, {level_color}dd);
                   color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px;">
            <h2 style="margin: 0 0 15px 0; font-size: 2rem;">
                {dim_name} ({selected_dim})
            </h2>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; font-size: 1.5rem;">Niveau : {interp['level']}</h3>
                    <p style="margin: 5px 0 0 0; font-size: 1.1rem;">
                        {interp['percentile']:.0f}e percentile
                    </p>
                </div>
                <div style="font-size: 3rem; opacity: 0.7;">
                    {interp['percentile']:.0f}%
                </div>
            </div>
        </div>
        """, unsafe_allow_html=True)

        # Description dÃ©taillÃ©e
        st.markdown(f"""
        <div class="info-card">
            <h4 style="color: #2c3e50; margin-top: 0;">ğŸ“ InterprÃ©tation de votre score</h4>
            <p style="color: #34495e; line-height: 1.8; font-size: 1.1rem;">
                {interp['description']}
            </p>
        </div>
        """, unsafe_allow_html=True)

        # Graphique des facettes
        if selected_dim in st.session_state.facet_scores:
            st.markdown("### ğŸ” Analyse des Facettes")

            fig_facets = create_facet_chart(st.session_state.facet_scores, selected_dim)
            st.plotly_chart(fig_facets, use_container_width=True)

            # Explication des facettes
            st.markdown("#### ğŸ“š Explication des Facettes")

            facets_descriptions = {
                'N': {
                    'AnxiÃ©tÃ©': "Tendance Ã  s'inquiÃ©ter, Ã  ressentir de la nervositÃ© et de la tension",
                    'HostilitÃ©': "Tendance Ã  Ã©prouver de la colÃ¨re, de la frustration et de l'amertume",
                    'DÃ©pression': "Tendance Ã  se sentir triste, dÃ©couragÃ© et dÃ©sespÃ©rÃ©",
                    'TimiditÃ© sociale': "Tendance Ã  se sentir mal Ã  l'aise en prÃ©sence d'autres personnes",
                    'ImpulsivitÃ©': "Tendance Ã  agir sans rÃ©flÃ©chir aux consÃ©quences",
                    'VulnÃ©rabilitÃ©': "Tendance Ã  se sentir incapable de gÃ©rer le stress"
                },
                'E': {
                    'Chaleur': "CapacitÃ© Ã  Ã©tablir des relations chaleureuses et amicales",
                    'GrÃ©garitÃ©': "PrÃ©fÃ©rence pour la compagnie des autres",
                    'AssertivitÃ©': "Tendance Ã  Ãªtre dominant, Ã©nergique et socialement visible",
                    'ActivitÃ©': "Rythme de vie rapide et niveau d'Ã©nergie Ã©levÃ©",
                    'Recherche de sensations': "Besoin d'excitation et de stimulation",
                    'Ã‰motions positives': "Tendance Ã  Ã©prouver de la joie, du bonheur et de l'optimisme"
                },
                'O': {
                    'Fantaisie': "Imagination active et vie intÃ©rieure riche",
                    'EsthÃ©tique': "ApprÃ©ciation de l'art, de la beautÃ© et de la poÃ©sie",
                    'Sentiments': "RÃ©ceptivitÃ© Ã  ses propres Ã©motions et celles des autres",
                    'Actions': "VolontÃ© d'essayer de nouvelles activitÃ©s et d'aller vers l'inconnu",
                    'IdÃ©es': "CuriositÃ© intellectuelle et ouverture aux nouvelles idÃ©es",
                    'Valeurs': "Disposition Ã  remettre en question les valeurs Ã©tablies"
                },
                'A': {
                    'Confiance': "Disposition Ã  croire que les autres sont honnÃªtes et bienveillants",
                    'Droiture': "Franchise et sincÃ©ritÃ© dans les relations avec autrui",
                    'Altruisme': "PrÃ©occupation active pour le bien-Ãªtre des autres",
                    'Compliance': "Tendance Ã  Ã©viter les conflits et Ã  coopÃ©rer",
                    'Modestie': "Tendance Ã  Ãªtre humble et effacÃ©",
                    'SensibilitÃ©': "Attitude de sympathie et de compassion envers les autres"
                },
                'C': {
                    'CompÃ©tence': "Sentiment d'Ãªtre capable, sensÃ© et efficace",
                    'Ordre': "Tendance Ã  Ãªtre organisÃ©, soigneux et bien structurÃ©",
                    'Sens du devoir': "Respect des obligations sociales et morales",
                    'Recherche de rÃ©ussite': "Effort pour exceller et rÃ©ussir",
                    'Autodiscipline': "CapacitÃ© Ã  persÃ©vÃ©rer dans des tÃ¢ches difficiles",
                    'DÃ©libÃ©ration': "Tendance Ã  rÃ©flÃ©chir soigneusement avant d'agir"
                }
            }

            for facet, score in st.session_state.facet_scores[selected_dim].items():
                description = facets_descriptions[selected_dim][facet]
                st.markdown(f"""
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;
                           border-left: 4px solid #3498db;">
                    <h5 style="color: #2c3e50; margin: 0 0 8px 0;">
                        {facet} (Score: {score})
                    </h5>
                    <p style="color: #6c757d; margin: 0; font-size: 0.95rem;">
                        {description}
                    </p>
                </div>
                """, unsafe_allow_html=True)

    with tab4:
        # Recommandations personnalisÃ©es
        st.markdown("## ğŸ’¡ Recommandations PersonnalisÃ©es")

        # Analyse des forces et dÃ©fis
        forces = []
        defis = []

        for dim, interp in st.session_state.interpretations.items():
            dim_name = neo_manager.dimensions[dim]
            if interp['level'] == 'Ã‰levÃ©':
                if dim in ['E', 'O', 'A', 'C']:  # Traits gÃ©nÃ©ralement positifs quand Ã©levÃ©s
                    forces.append(f"{dim_name} : {interp['description']}")
                else:  # Neuroticisme Ã©levÃ© peut Ãªtre un dÃ©fi
                    defis.append(f"{dim_name} : {interp['description']}")
            elif interp['level'] == 'Faible':
                if dim == 'N':  # Neuroticisme faible est gÃ©nÃ©ralement positif
                    forces.append(f"{dim_name} faible : {interp['description']}")
                else:
                    defis.append(f"{dim_name} : {interp['description']}")

        col1, col2 = st.columns(2)

        with col1:
            st.markdown("### ğŸŒŸ Vos Forces")
            if forces:
                for force in forces:
                    st.markdown(f"""
                    <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 10px 0;
                               border-left: 4px solid #28a745;">
                        <p style="color: #155724; margin: 0; line-height: 1.5;">
                            âœ… {force}
                        </p>
                    </div>
                    """, unsafe_allow_html=True)
            else:
                st.info("Votre profil prÃ©sente un Ã©quilibre dans toutes les dimensions.")

        with col2:
            st.markdown("### ğŸ¯ Axes de DÃ©veloppement")
            if defis:
                for defi in defis:
                    st.markdown(f"""
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0;
                               border-left: 4px solid #ffc107;">
                        <p style="color: #856404; margin: 0; line-height: 1.5;">
                            ğŸ”„ {defi}
                        </p>
                    </div>
                    """, unsafe_allow_html=True)
            else:
                st.info("Votre profil ne prÃ©sente pas d'axes de dÃ©veloppement particuliers.")

        # Recommandations par domaine
        st.markdown("### ğŸ¯ Recommandations par Domaine de Vie")

        # CarriÃ¨re professionnelle
        career_recommendations = {
            'N': {
                'Ã‰levÃ©': "Envisagez des environnements de travail structurÃ©s et prÃ©visibles. Les mÃ©tiers d'aide peuvent vous convenir.",
                'Faible': "Vous pourriez exceller dans des postes Ã  haute responsabilitÃ© ou des environnements stressants."
            },
            'E': {
                'Ã‰levÃ©': "Les mÃ©tiers commerciaux, de management ou de relations publiques pourraient vous Ã©panouir.",
                'Faible': "Vous pourriez prÃ©fÃ©rer des mÃ©tiers techniques, de recherche ou de crÃ©ation en autonomie."
            },
            'O': {
                'Ã‰levÃ©': "Les domaines crÃ©atifs, artistiques ou de recherche correspondent Ã  votre profil.",
                'Faible': "Vous pourriez exceller dans des domaines nÃ©cessitant rigueur et mÃ©thode traditionnelle."
            },
            'A': {
                'Ã‰levÃ©': "Les mÃ©tiers d'aide, d'enseignement ou de collaboration d'Ã©quipe vous conviendront.",
                'Faible': "Vous pourriez rÃ©ussir dans des postes de nÃ©gociation ou de leadership compÃ©titif."
            },
            'C': {
                'Ã‰levÃ©': "Les mÃ©tiers nÃ©cessitant organisation et persÃ©vÃ©rance correspondent Ã  vos forces.",
                'Faible': "PrivilÃ©giez des environnements flexibles permettant la crÃ©ativitÃ© et l'adaptation."
            }
        }

        st.markdown("#### ğŸ’¼ Orientation Professionnelle")
        career_card = ""
        for dim, interp in st.session_state.interpretations.items():
            if interp['level'] in ['Ã‰levÃ©', 'Faible']:
                dim_name = neo_manager.dimensions[dim]
                recommendation = career_recommendations[dim].get(interp['level'], "")
                if recommendation:
                    career_card += f"â€¢ **{dim_name}** : {recommendation}\n"

        if career_card:
            st.markdown(f"""
            <div class="info-card">
                <h5 style="color: #2c3e50; margin-top: 0;">ğŸ¯ Suggestions d'orientation</h5>
                <div style="color: #34495e; line-height: 1.6;">
                    {career_card}
                </div>
            </div>
            """, unsafe_allow_html=True)

        # Relations interpersonnelles
        st.markdown("#### ğŸ‘¥ Relations Interpersonnelles")

        relationship_tips = []

        if st.session_state.interpretations['E']['level'] == 'Ã‰levÃ©':
            relationship_tips.append("Votre nature sociable est un atout. Veillez Ã  laisser de l'espace aux personnes plus introverties.")
        elif st.session_state.interpretations['E']['level'] == 'Faible':
            relationship_tips.append("Votre prÃ©fÃ©rence pour l'intimitÃ© est prÃ©cieuse. N'hÃ©sitez pas Ã  communiquer vos besoins d'espace.")

        if st.session_state.interpretations['A']['level'] == 'Ã‰levÃ©':
            relationship_tips.append("Votre bienveillance naturelle est apprÃ©ciÃ©e. Attention Ã  ne pas vous oublier.")
        elif st.session_state.interpretations['A']['level'] == 'Faible':
            relationship_tips.append("Votre franc-parler peut Ãªtre rafraÃ®chissant. Travaillez sur l'empathie pour renforcer vos relations.")

        if st.session_state.interpretations['N']['level'] == 'Ã‰levÃ©':
            relationship_tips.append("Votre sensibilitÃ© Ã©motionnelle peut enrichir vos relations. Partagez vos besoins avec vos proches.")

        for tip in relationship_tips:
            st.markdown(f"""
            <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 10px 0;
                       border-left: 4px solid #3498db;">
                <p style="color: #2c3e50; margin: 0; line-height: 1.5;">
                    ğŸ’­ {tip}
                </p>
            </div>
            """, unsafe_allow_html=True)

        # DÃ©veloppement personnel
        st.markdown("#### ğŸŒ± DÃ©veloppement Personnel")

        development_suggestions = []

        for dim, interp in st.session_state.interpretations.items():
            dim_name = neo_manager.dimensions[dim]

            if dim == 'N' and interp['level'] == 'Ã‰levÃ©':
                development_suggestions.append("Pratiquez la mÃ©ditation ou la relaxation pour gÃ©rer le stress")
            elif dim == 'E' and interp['level'] == 'Faible':
                development_suggestions.append("Fixez-vous des objectifs sociaux progressifs pour Ã©largir votre rÃ©seau")
            elif dim == 'O' and interp['level'] == 'Faible':
                development_suggestions.append("Essayez une nouvelle activitÃ© crÃ©ative ou culturelle chaque mois")
            elif dim == 'A' and interp['level'] == 'Faible':
                development_suggestions.append("Pratiquez l'Ã©coute active et l'empathie dans vos interactions")
            elif dim == 'C' and interp['level'] == 'Faible':
                development_suggestions.append("Utilisez des outils d'organisation pour structurer vos projets")

        if development_suggestions:
            for suggestion in development_suggestions:
                st.markdown(f"""
                <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 10px 0;
                           border-left: 4px solid #4169e1;">
                    <p style="color: #1e3a8a; margin: 0; line-height: 1.5;">
                        ğŸš€ {suggestion}
                    </p>
                </div>
                """, unsafe_allow_html=True)

        # Bouton pour refaire le test
        st.markdown("<br><br>", unsafe_allow_html=True)

        col1, col2, col3 = st.columns([1, 2, 1])
        with col2:
            if st.button("ğŸ”„ Refaire le Test", use_container_width=True):
                # Reset de l'Ã©tat
                st.session_state.test_started = False
                st.session_state.test_completed = False
                st.session_state.responses = {}
                st.session_state.current_question = 0
                st.session_state.scores = {}
                st.session_state.interpretations = {}
                st.session_state.tool_choice = "ğŸ“ Passer le Test"
                st.rerun()

def show_about_page():
    """Page Ã  propos du test NEO PI-R"""
    st.markdown("""
    <div style="background: linear-gradient(90deg, #9b59b6, #8e44ad);
                padding: 40px 25px; border-radius: 20px; margin-bottom: 35px; text-align: center;">
        <h1 style="color: white; font-size: 2.8rem; margin-bottom: 15px;
                   text-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: 600;">
            â„¹ï¸ Ã€ Propos du NEO PI-R
        </h1>
        <p style="color: rgba(255,255,255,0.95); font-size: 1.3rem;
                  max-width: 800px; margin: 0 auto; line-height: 1.6;">
            Tout ce que vous devez savoir sur ce test de personnalitÃ©
        </p>
    </div>
    """, unsafe_allow_html=True)

    # Histoire et dÃ©veloppement
    st.markdown("""
    <div class="info-card">
        <h2 style="color: #3498db; margin-bottom: 25px; font-size: 2.2rem;">
            ğŸ“š Histoire et DÃ©veloppement
        </h2>
        <p style="font-size: 1.1rem; line-height: 1.8; color: #2c3e50; margin-bottom: 20px;">
            Le NEO PI-R a Ã©tÃ© dÃ©veloppÃ© par <strong>Paul T. Costa Jr.</strong> et <strong>Robert R. McCrae</strong>
            au National Institute on Aging (NIH) dans les annÃ©es 1980-1990. Il s'agit de l'une des mesures
            les plus utilisÃ©es et validÃ©es scientifiquement pour Ã©valuer la personnalitÃ© selon le modÃ¨le
            des Big Five.
        </p>
        <p style="font-size: 1.1rem; line-height: 1.8; color: #2c3e50;">
            Ce modÃ¨le est le fruit de dÃ©cennies de recherche en psychologie de la personnalitÃ© et
            reprÃ©sente un consensus scientifique sur les dimensions fondamentales de la personnalitÃ© humaine.
        </p>
    </div>
    """, unsafe_allow_html=True)

    # ValiditÃ© scientifique
    st.markdown("## ğŸ”¬ ValiditÃ© Scientifique")

    col1, col2 = st.columns(2)

    with col1:
        st.markdown("""
        <div style="background: #e8f4fd; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
            <h4 style="color: #2980b9; margin-top: 0;">ğŸ“Š Recherche Extensive</h4>
            <ul style="color: #34495e; padding-left: 20px; line-height: 1.6;">
                <li>Plus de 2000 Ã©tudes publiÃ©es</li>
                <li>ValidÃ© dans plus de 50 cultures</li>
                <li>Traduit en plus de 40 langues</li>
                <li>UtilisÃ© dans la recherche depuis 30+ ans</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)

        st.markdown("""
        <div style="background: #fff3cd; padding: 20px; border-radius: 15px;">
            <h4 style="color: #856404; margin-top: 0;">ğŸ¯ Applications Cliniques</h4>
            <ul style="color: #856404; padding-left: 20px; line-height: 1.6;">
                <li>Orientation professionnelle</li>
                <li>ThÃ©rapie personnalisÃ©e</li>
                <li>Recherche en psychologie</li>
                <li>DÃ©veloppement personnel</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)

    with col2:
        st.markdown("""
        <div style="background: #d4edda; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
            <h4 style="color: #155724; margin-top: 0;">âœ… FiabilitÃ© Ã‰prouvÃ©e</h4>
            <ul style="color: #155724; padding-left: 20px; line-height: 1.6;">
                <li>Consistance interne Ã©levÃ©e (Î± > 0.85)</li>
                <li>StabilitÃ© temporelle dÃ©montrÃ©e</li>
                <li>ValiditÃ© convergente et discriminante</li>
                <li>CorrÃ©lations inter-Ã©valuateurs fortes</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)

        st.markdown("""
        <div style="background: #f8d7da; padding: 20px; border-radius: 15px;">
            <h4 style="color: #721c24; margin-top: 0;">ğŸŒ Impact International</h4>
            <ul style="color: #721c24; padding-left: 20px; line-height: 1.6;">
                <li>Standard mondial en personnalitÃ©</li>
                <li>RÃ©fÃ©rence pour autres tests</li>
                <li>UtilisÃ© par l'OMS</li>
                <li>IntÃ©grÃ© dans DSM et CIM</li>
            </ul>
        </div>
        """, unsafe_allow_html=True)

    # InterprÃ©tation des scores
    st.markdown("## ğŸ“ˆ Comprendre Vos Scores")

    st.markdown("""
    <div class="info-card">
        <h4 style="color: #2c3e50; margin-top: 0;">ğŸ“Š SystÃ¨me de Percentiles</h4>
        <p style="color: #34495e; line-height: 1.6; margin-bottom: 20px;">
            Vos scores sont exprimÃ©s en <strong>percentiles</strong>, ce qui signifie le pourcentage
            de personnes dans la population gÃ©nÃ©rale qui obtiennent un score infÃ©rieur au vÃ´tre.
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 15px; margin-top: 20px;">
            <div style="background: #3498db; color: white; padding: 15px; border-radius: 10px; text-align: center;">
                <h5 style="margin: 0 0 10px 0;">0-30e percentile</h5>
                <p style="margin: 0; font-size: 0.9rem;">Score Faible</p>
            </div>
            <div style="background: #f39c12; color: white; padding: 15px; border-radius: 10px; text-align: center;">
                <h5 style="margin: 0 0 10px 0;">30-70e percentile</h5>
                <p style="margin: 0; font-size: 0.9rem;">Score Moyen</p>
            </div>
            <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 10px; text-align: center;">
                <h5 style="margin: 0 0 10px 0;">70-100e percentile</h5>
                <p style="margin: 0; font-size: 0.9rem;">Score Ã‰levÃ©</p>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Limitations et considÃ©rations
    st.markdown("## âš ï¸ Limitations et ConsidÃ©rations")

    st.markdown("""
    <div style="background: #fff3cd; padding: 20px; border-radius: 15px; margin: 20px 0;
               border-left: 4px solid #ffc107;">
        <h4 style="color: #856404; margin-top: 0;">ğŸ” Points Importants Ã  Retenir</h4>
        <ul style="color: #856404; padding-left: 25px; line-height: 1.8;">
            <li><strong>Outil descriptif</strong> : Le test dÃ©crit votre personnalitÃ©, il ne la juge pas</li>
            <li><strong>Pas de profil parfait</strong> : Chaque combinaison de traits a ses avantages</li>
            <li><strong>Ã‰volution possible</strong> : La personnalitÃ© peut changer avec l'Ã¢ge et les expÃ©riences</li>
            <li><strong>Contexte culturel</strong> : Les normes peuvent varier selon les cultures</li>
            <li><strong>ComplÃ©ment d'information</strong> : Ã€ utiliser avec d'autres sources d'information</li>
            <li><strong>But Ã©ducatif</strong> : Ne remplace pas une Ã©valuation psychologique professionnelle</li>
        </ul>
    </div>
    """, unsafe_allow_html=True)

    # Utilisations recommandÃ©es
    st.markdown("## ğŸ¯ Utilisations RecommandÃ©es")

    col1, col2, col3 = st.columns(3)

    uses = [
        {
            "title": "ğŸ’­ DÃ©veloppement Personnel",
            "items": ["Mieux se comprendre", "Identifier ses forces", "Planifier sa croissance", "AmÃ©liorer ses relations"],
            "color": "#3498db"
        },
        {
            "title": "ğŸ’¼ Orientation Professionnelle",
            "items": ["Choix de carriÃ¨re", "Style de management", "Dynamique d'Ã©quipe", "Formation continue"],
            "color": "#2ecc71"
        },
        {
            "title": "ğŸ“ Contexte Ã‰ducatif",
            "items": ["Orientation scolaire", "MÃ©thodes d'apprentissage", "Projets de groupe", "DÃ©veloppement Ã©tudiant"],
            "color": "#9b59b6"
        }
    ]

    for i, (use, col) in enumerate(zip(uses, [col1, col2, col3])):
        with col:
            items_html = "".join([f"<li>{item}</li>" for item in use['items']])
            st.markdown(f"""
            <div style="background: {use['color']}; color: white;
                       padding: 25px; border-radius: 15px; height: 280px;">
                <h4 style="margin: 0 0 20px 0; font-size: 1.2rem;
                          border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                    {use['title']}
                </h4>
                <ul style="padding-left: 20px; margin: 0; line-height: 1.6;">
                    {items_html}
                </ul>
            </div>
            """, unsafe_allow_html=True)

    # Ressources supplÃ©mentaires
    st.markdown("## ğŸ“š Ressources SupplÃ©mentaires")

    st.markdown("""
    <div class="info-card">
        <h4 style="color: #2c3e50; margin-top: 0;">ğŸ“– Pour Aller Plus Loin</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px; margin-top: 20px;">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <h5 style="color: #3498db; margin: 0 0 10px 0;">ğŸ“š Livres RecommandÃ©s</h5>
                <ul style="color: #6c757d; font-size: 0.9rem; padding-left: 20px;">
                    <li>"Personality in Adulthood" - Costa & McCrae</li>
                    <li>"The Big Five Personality Dimensions" - Goldberg</li>
                    <li>"Personality Psychology" - Larsen & Buss</li>
                </ul>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <h5 style="color: #3498db; margin: 0 0 10px 0;">ğŸ”— Sites Web Utiles</h5>
                <ul style="color: #6c757d; font-size: 0.9rem; padding-left: 20px;">
                    <li>American Psychological Association</li>
                    <li>International Personality Psychology</li>
                    <li>Research Gate Publications</li>
                </ul>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # Contact et support
    st.markdown("## ğŸ“ Contact et Support")

    st.markdown("""
    <div style="background: linear-gradient(135deg, #667eea, #764ba2);
               color: white; padding: 30px; border-radius: 15px; text-align: center;">
        <h4 style="margin: 0 0 20px 0; font-size: 1.5rem;">ğŸ’¬ Besoin d'Aide ?</h4>
        <p style="margin: 0 0 15px 0; line-height: 1.6;">
            Si vous avez des questions sur vos rÃ©sultats ou souhaitez approfondir votre analyse,
            n'hÃ©sitez pas Ã  consulter un professionnel de la psychologie.
        </p>
        <p style="margin: 0; font-size: 0.9rem; opacity: 0.8;">
            Ce test est fourni Ã  des fins Ã©ducatives et de dÃ©veloppement personnel uniquement.
        </p>
    </div>
    """, unsafe_allow_html=True)

# ================= FONCTION PRINCIPALE =================

def main():
    """Fonction principale de l'application"""
    # Initialisation
    initialize_session_state()
    set_custom_theme()

    # Initialisation du gestionnaire de sÃ©curitÃ©
    if 'security_manager' not in st.session_state:
        st.session_state.security_manager = SecurityManager()

    # Sidebar avec navigation
    with st.sidebar:
        tool_choice = show_navigation_menu()

    # Routage des pages
    if tool_choice == "ğŸ  Accueil":
        show_home_page()
    elif tool_choice == "ğŸ“ Passer le Test":
        show_test_page()
    elif tool_choice == "ğŸ“Š RÃ©sultats":
        show_results_page()
    elif tool_choice == "â„¹ï¸ Ã€ propos":
        show_about_page()

# ================= POINT D'ENTRÃ‰E =================

if __name__ == "__main__":
    main()